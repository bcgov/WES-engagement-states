---
title: "Engagement States"
author: "Martin Monkman"
date: "September 2, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Employee Engagement

Employee engagement is made up of three components:
* job satisfaction
* organization satisfaction
* commitment 

This chart ...

```{r echo = FALSE, message = FALSE}

# preliminaries

setwd("C:/@data/GitHub/WES-engagement-states")

library(ggplot2)
library(dplyr)

eng_state_data <- read.csv("./data/eng_states_data.csv")

eng_state_data <- eng_state_data %>%
  group_by(ORGID) %>%
  mutate(org_pct = Employees/sum(Employees)*100)

head(eng_state_data)

# set the sort function 

eng_state_data$Engagement.State <- factor(eng_state_data$Engagement.State, 
       levels = c("Engaged", "Moderately Engaged",
                  "Happily Detached", "Unhappily Dedicated",
                  "Minimally Engaged", "Disengaged"))
         

eng_state_data <- eng_state_data %>%
  arrange(ORG, Engagement.State)

eng_state_data

eng_state_data <- eng_state_data %>%
  group_by(ORGID) %>%
  mutate(Percent = round(Employees / sum(Employees) * 100)) %>%
  ungroup() %>%
  arrange(ORG, Engagement.State)

head(eng_state_data)


```


### The Plot

Basic plots

```{r}

eng_state_plot <- ggplot(subset(eng_state_data, ORGID == "OWL",),
            aes(x = Commitment, y = Satisfaction))

eng_state_plot + 
  geom_point(aes(size = org_pct))

eng_state_plot + 
  geom_point(aes(size = org_pct), shape = 21, colour = "black", fill = "cornsilk") +
  scale_size_area(max_size = 65, guide=FALSE)

# set axis

eng_state_plot + 
  geom_point(aes(size = org_pct), shape = 21, colour = "black", fill = "cornsilk") +
  scale_size_area(max_size = 50, guide=FALSE) +
  xlim(0, 100) +
  ylim(0, 100)



```


Add colour to the balloons

1. Using a Colour Brewer palette -- light to dark

```{r}

eng_state_plot <- 
  ggplot(subset(eng_state_data, ORGID == "OWL",),
            aes(x = Commitment, y = Satisfaction, fill = Engagement.State)) + 
  geom_point(aes(size = org_pct, stat="identity"), 
             shape = 21, colour = "black") +
  scale_size_area(max_size = 50, guide=FALSE) + 
  xlim(0,100) + ylim(0,100) +
  scale_fill_manual(values=c("#edf8fb", "#ccece6", "#99d8c9", 
                               "#66c2a4", "#2ca25f", "#006d2c"))


eng_state_plot  


```

2. official colour palette 

RGB codes:

Engaged -- Dark Blue: 50, 90, 128  -- #325A80
Moderately Engaged -- Light Blue: 80, 145, 205 -- #5091CD
Happily Detached -- Yellow: 255, 255, 5 -- #FFFF05
Unhappily Dedicated -- Muddy Orange: 210, 190, 50 -- #D2BE32
Minimally Engaged -- Red: 250, 30, 30 -- #FA1E1E
Disengaged -- Dark Red: 164, 0, 0 -- #A40000



```{r}

# Constants to use in the code
PLOT_COLS <- c("#325A80", "#5091CD", "#FFFF05", "#D2BE32", "#FA1E1E", "#A40000")


# additional variables for the plot

data <- (subset(eng_state_data, ORGID == "OWL"))

  mean_satisfaction <- sum(data$Satisfaction * data$Percent / 100)
  mean_commitment <- sum(data$Commitment * data$Percent / 100)


eng_state_plot <- 
  ggplot(data,
         aes(x = Commitment, y = Satisfaction, fill = Engagement.State)) +   
  # points
  geom_point(aes(size = org_pct, stat="identity"), 
             shape = 21, colour = "black") +
  scale_size_area(max_size = 50, guide=FALSE) + 
  scale_fill_manual(values = PLOT_COLS) + 
  # cross-hairs
  geom_vline(xintercept = mean_commitment, col = "#555555") +
  geom_hline(yintercept = mean_satisfaction, col = "#555555") +
  # axis
  scale_x_continuous(breaks=c(0,25,50,75,100), limits=c(-10,125)) +
  scale_y_continuous(breaks=c(0,25,50,75,100), limits=c(-10,125)) +
  coord_fixed() +
    
  theme_bw(26) +
  guides(fill = guide_legend("Engagement State", override.aes = list(size = 4))) +
  theme(legend.key = element_blank(), panel.grid.minor = element_blank(),
        legend.key.height = unit(1.5, "line")) 


eng_state_plot  


```

Add:


* sort by rank (not alphabetical)

* numeric labels

* theme


-30-
